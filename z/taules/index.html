<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
    * {
        font-family: 'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif;
        user-select: none;
    }

    #app{
        height: 90vh;
        display: grid;
        grid-template-rows: 1fr 1fr 4fr 1fr 3fr;
        gap: 0.8em;
    }

    #operation {
        font-size: 5em;
        text-align: center;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    #kb {
        display: grid;
        grid-template-columns: repeat(5, 1fr);
        gap: 0.2em;
    }
    #kb span {
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 0.4em;
        text-align: center;
        font-size: 2em;
        border-radius: 8px;
        background: rgb(231, 68, 231);
        color: white;
    }
    #response {
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: xx-large;
    }
    #pointsW {
        display: flex;
        align-items: center;
        justify-content: center;
        text-align: right;
        font-size: xx-large;
    }
    #conf {
        display: flex;
        justify-content: space-around;
        align-items: center;
        background-color: rgb(236, 212, 181);
        padding: 0.3em;
    }
    #conf span {
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: #a1dc93;
        height: 2em;
        border-radius: 50%;
        aspect-ratio: 1/1;
    }
    #conf span.disabled {
        background-color: #a8a8a8;
    }

    .shaking {
        animation: shaking 0.15s 1;
    }
    .pulse {
        animation: pulse 0.25s 1;
    }
    .light {
        animation: light 2.15s 1 ;
    }
    @keyframes shaking {
        0% { 
            transform: translateX(0);
        }
        25% { transform: translateX(5px) }
        50% {
            filter: blur(5px); 
            transform: translateX(-5px);
        
        }
        75% { transform: translateX(5px) }
        100% { transform: translateX(0);
            filter: none; 
        }
    }
    @keyframes pulse {
        30% {
            transform: scale(1.05);
            text-shadow: 0 0 1em #28c800;
        }
        96% {
            transform: scale(0.99);
        }
        100% {
            text-shadow: none;
            transform: scale(1);
        }
    }

    @keyframes light {
        100% {
            box-shadow: 0 0 4px green;
        }
    }

</style>
<div id="app">
    <div id="conf"></div>
    <div id="pointsW">✅ <span id="points"></span></div>
    <div id="operation"></div>
    <div id="response"></div>
    <div id="kb"></div>
</div>


<script>
    let result;
    let operationValue;
    let responseValue="";
    let l = console.log;
    let pointsValue = 0;
    let taules = new Set([2,3,4,5,6,7,8,9]);

    points.innerHTML = pointsValue;

    loadTaules();
    newOperation();
    showTaules();

    function loadTaules() {
        if (localStorage.getItem("taules")){
            taules = new Set(JSON.parse(localStorage.getItem("taules")));
        } else {
            taules = new Set([2,3,4,5,6,7,8,9]);
        }
    }

    function saveTaules(){
        localStorage.setItem("taules", JSON.stringify(Array.from(taules)));
    }

    for(let i=0; i<10; i++) {
        kb.innerHTML += `<span onclick="p(${i})">${i}</span>`;
    }

    function showTaules(){
        conf.innerHTML = "";
        for(let i=2; i<10; i++) {
            if (taules.has(i)){
                conf.innerHTML += `<span id="taula${i}" onclick="c(${i})">${i}</span>`;
            } else {
                conf.innerHTML += `<span id="taula${i}" class="disabled" onclick="c(${i})">${i}</span>`;
            }
        }
    }

    function newOperation(){
        let op1 = Math.floor(Math.random()*8)+2;
        while(!taules.has(op1)){
            op1 = Math.floor(Math.random()*8)+2;
        }
        let op2 = Math.floor(Math.random()*8)+2;

        result = ""+op1*op2;
        operationValue = op1 + "×" + op2;
        operation.innerHTML = operationValue;
    }

    function c(i) {
        if (taules.has(i)){
            if (taules.size > 1){
                taules.delete(i);
                document.getElementById(`taula${i}`).classList.add("disabled");
            }
        } else {
            taules.add(i);
            document.getElementById(`taula${i}`).classList.remove("disabled");
            animate(document.getElementById(`taula${i}`), "light");
        }
        saveTaules();
        newOperation();
    }

    function p(i) {
        responseValue = `${responseValue}${i}`;

        if (responseValue == result) {
            responseValue = "";
            pointsValue++;
            points.innerHTML = pointsValue;
            animate(pointsW, "pulse");            
            newOperation();
        } else if (!result.startsWith(responseValue)){
            responseValue = "";
            animate(app, "shaking");
        }
        response.innerHTML = responseValue;
    }

    function animate(element, animation) {
        element.classList.add(animation);
        element.addEventListener('animationend', () => { element.classList.remove(animation);});
    }
</script>

