<!DOCTYPE html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<script type="module" src="/sofi/js/script.js"></script>
<link rel="stylesheet" href="/sofi/css/estil.css">

<header>
    <h1>Navigation</h1>

    <abstract>
        <p>El componente
            <a href="https://developer.android.com/guide/navigation/navigation-ui">Navigation</a> 
            incluye una clase <w>NavigationUI</w>. Esta clase contiene métodos estáticos que 
            administran la navegación con el <w>NavigationView</w>, el <w>BottomNavigationView</w> 
            y el <w>OptionsMenu</w>.</p>

        <img src="img/NavigationUI.png">

        <p>Además de usar estos elementos de navegación, en esta práctica usaremos también 
            la navegación mediante Tabs (o pestañas), usando los elementos <w>TabLayout</w>
            y <w>ViewPager2</w>, aunque estos no están incluidos en el 
            componente Navigation.
        </p>

        <img src="img/TabLayoutViewPager.png">

        <p>Desarrollaremos una app que permitirá navegar entre destinos usando todos estos elementos.
        </p>
        <img src="img/navigation.gif">        
        <a href="https://github.com/gerardfp/navigation">https://github.com/gerardfp/navigation</a>
    </abstract>
</header>
            
<section><h2>Crea el proyecto</h2>

    <warn>
        <p>En el asistente de "Nueva Activity", Android Studio proporciona plantillas para crear 
            Activities que incluyen estos componentes
            de navegación. Sin embargo, esta vez lo haremos "desde 0", para comprender todos 
        los elementos que intervienen.</p>    
    </warn>

    <ol>

    <li>
        <p>Selecciona &#34;<strong>Empty Activity</strong>&#34; como plantilla para la MainActivity</p>
    </li>

    <li>
        <p>Añade las dependencias para incluir el componente Navigation, ViewPager2 y Material:</p>
    
        <codefile>
            build.gradle (Module: app)
        </codefile>
        <code data-line="2,3,4,5">
            dependencies {
                implementation &#39;androidx.navigation:navigation-fragment:2.3.0&#39;
                implementation &#39;androidx.navigation:navigation-ui:2.3.0&#39;
                implementation 'androidx.viewpager2:viewpager2:1.0.0'
                implementation 'com.google.android.material:material:1.3.0-alpha03'
            }
        </code>
    </li>

    <li>
        <p>Habilita el ViewBinding: </p>
        <codefile>
            build.gradle (Module: app)
        </codefile>
        <code data-line="2-4">
            android {
                buildFeatures {
                    viewBinding true
                }
            }
        </code>
    </li>

    <li>
        <p>Por último, deshabilitaremos la <w>ActionBar</w> (la barra superior) que se incluye 
        de forma automática en todas las Activities, ya que en este proyecto utilizaremos la versión 
        más reciente <w>Toolbar</w>, que se integra mejor con los elementos de navegación:</p>

        <p>Añade los siguientes elementos al fichero <file>styles.xml</file>:</p>

        <codefile>
            res/values/styles.xml
        </codefile>
        <code xml data-line="5,6">
            &lt;resources&gt;
                &lt;style name="AppTheme" parent="Theme.AppCompat.Light.DarkActionBar"&gt;
                    ...

                    &lt;item name="windowActionBar"&gt;false&lt;/item&gt;
                    &lt;item name="windowNoTitle"&gt;true&lt;/item&gt;
                &lt;/style&gt;
            &lt;/resources&gt;
        </code>

        <info>
            <p>Para más info sobre la actualización de la <w>ActionBar</w> por la <w>Toolbar</w>, consulta:
                <a href="https://developer.android.com/training/appbar/setting-up">Cómo configurar la barra de la app</a>
            </p>
        </info>
    </li>
</ol>
</section>

<section>
    <h2>Activities</h2>

    <p>Cada uno de elementos de navegación (<w>NavigationView</w>, <w>BottomNavigationView</w>, <w>OptionsMenu</w> y <w>TabLayout + ViewPager2</w>) 
        lo implementaremos en una <w>Activity</w> diferente y usaremos la <w>MainActivity</w> para lanzar las diferentes Activities.</p>

    <img src="img/navigation activies.png">


    <p>Empezaremos creando estas Activities, con los nombres: <w>DrawerActivity</w>, <w>BottomActivity</w>, <w>OptionsActivity</w> y <w>TabbedActivity</w>.</p>

    <p>Para crear una Activity selcciona <menuoption >New ⯈</menuoption> <menuoption>Activity ⯈</menuoption> <menuoption>Empty Activity</menuoption> e introduce el nombre en el campo <menuoption>Activity Name</menuoption></p>

    <img src="img/created_activies.png">

    <observe>
        <p>Observa que cuando creas una Activity con el asistente, e introduces un nombre como <name>AbcActivity</name>, automáticamente se crea
        un archivo <w>AbcActivity.java</w> para la clase, y otro <w>activity_abc.xml</w> para el layout.</p>

        <p>También se crea una entrada para la activity en el elemento <w>&lt;application&gt;</w> del fichero <w>AndroidManifest</w>.</p>
    </observe>

    <h3>Toolbar</h3>
    <p>Ahora el siguinte paso será añadir una <w>Toolbar</w> en cada una de estas activities.</p>
    <p>La <w>Toolbar</w> se utilitza conjuntamente con el <w>CoordinatorLayout</w> y el <w>AppBarLayout</w> que permiten 
    utilizar transiciones y animaciones (por ejemplo una Collapsing Toolbar). Aunque en esta práctica no las haremos, mejor 
    si la usamos desde el principio.</p>

    <p>Sustituye el layout de cada una de las 5 activities por este layout:</p>

    <codefile>
        res/layout/activity_$$$.xml
    </codefile>
    <code xml>
        &lt;?xml version="1.0" encoding="utf-8"?&gt;
        &lt;androidx.coordinatorlayout.widget.CoordinatorLayout
            xmlns:android="http://schemas.android.com/apk/res/android"
            xmlns:app="http://schemas.android.com/apk/res-auto"
            android:layout_width="match_parent"
            android:layout_height="match_parent"&gt;

            &lt;com.google.android.material.appbar.AppBarLayout
                android:id="@+id/appBarLayout"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:theme="@style/ThemeOverlay.AppCompat.Dark.ActionBar"&gt;

                &lt;androidx.appcompat.widget.Toolbar
                    android:id="@+id/toolbar"
                    android:layout_width="match_parent"
                    android:layout_height="?attr/actionBarSize"
                    android:background="?attr/colorPrimary"
                    app:popupTheme="@style/ThemeOverlay.AppCompat.Light" /&gt;
            &lt;/com.google.android.material.appbar.AppBarLayout&gt;

            &lt;androidx.constraintlayout.widget.ConstraintLayout
                android:layout_width="match_parent"
                android:layout_height="match_parent"
                app:layout_behavior="@string/appbar_scrolling_view_behavior"&gt;

                &lt;!-- Aqui va el contenido de la activity --&gt;

            &lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;

        &lt;/androidx.coordinatorlayout.widget.CoordinatorLayout&gt;
    </code>

    <h3>MainActivity</h3>
    <p>El siguiente paso es añadir 4 botones en la <w>MainActivity</w> para que cada uno nos lleve a una de las otras Activities.</p>

    <p>En el <w>&lt;ConstraintLayout&gt;</w> de la <w>activity_main.xml</w> añade los 4 botones:</p>

    <codefile>
        res/layout/activity_main.xml
    </codefile>
    <code xml data-line="5-40   ">
        &lt;androidx.constraintlayout.widget.ConstraintLayout
            android:layout_width="match_parent"
            android:layout_height="match_parent"&gt;

            &lt;Button
                android:id="@+id/action_goto_drawerActivity"
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:text="Drawer"
                app:layout_constraintBottom_toTopOf="@id/action_goto_bottomActivity"
                app:layout_constraintLeft_toLeftOf="parent"
                app:layout_constraintRight_toRightOf="parent"
                app:layout_constraintTop_toTopOf="parent" /&gt;
            &lt;Button
                android:id="@+id/action_goto_bottomActivity"
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:text="Bottom"
                app:layout_constraintBottom_toTopOf="@id/action_goto_optionsActivity"
                app:layout_constraintLeft_toLeftOf="parent"
                app:layout_constraintRight_toRightOf="parent"
                app:layout_constraintTop_toBottomOf="@id/action_goto_drawerActivity" /&gt;
            &lt;Button
                android:id="@+id/action_goto_optionsActivity"
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:text="Options"
                app:layout_constraintBottom_toTopOf="@id/action_goto_tabbedActivity"
                app:layout_constraintLeft_toLeftOf="parent"
                app:layout_constraintRight_toRightOf="parent"
                app:layout_constraintTop_toBottomOf="@id/action_goto_bottomActivity" /&gt;
            &lt;Button
                android:id="@+id/action_goto_tabbedActivity"
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:text="Tabs"
                app:layout_constraintBottom_toBottomOf="parent"
                app:layout_constraintLeft_toLeftOf="parent"
                app:layout_constraintRight_toRightOf="parent"
                app:layout_constraintTop_toBottomOf="@id/action_goto_optionsActivity" /&gt;

        &lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;
    </code>
    
    <p>Ahora implementamos el comportamiento del evento clic, añadiendo un <w>OnClickListener</w> en cada botón, 
        de manera que cuando se haga clic en un botón se iniciará la activity correspondiente.</p>

    <p>Para iniciar una Activity hay que llamar al método <w>startActivity()</w> y pasarle un objeto de clase
         <w>Intent</w>, 
    indicando en los parámetros del constructor el objeto de la Activity en la que estamos y la <strong>clase</strong> de 
    la Activity que queremos iniciar.</p>

    <p>Reemplaza el código de la clase <w>MainActivity</w> por este (¡excepto la primera linea del <w>package</w>!). 
        Usa <kbd>Alt + Intro</kbd> 
    para importar la clase de databinding):</p>

    <codefile>
        MainActivity.java
    </codefile>
    <code java data-line="15">
        import android.content.Intent;
        import android.os.Bundle;
        import android.view.View;
        import androidx.appcompat.app.AppCompatActivity;

        public class MainActivity extends AppCompatActivity {

            ActivityMainBinding binding;

            @Override
            protected void onCreate(Bundle savedInstanceState) {
                super.onCreate(savedInstanceState);
                setContentView((binding = ActivityMainBinding.inflate(getLayoutInflater())).getRoot());

                setSupportActionBar(binding.toolbar);

                binding.actionGotoDrawerActivity.setOnClickListener(new View.OnClickListener() {
                    @Override
                    public void onClick(View view) {
                        startActivity(new Intent(MainActivity.this, DrawerActivity.class));
                    }
                });

                binding.actionGotoBottomActivity.setOnClickListener(new View.OnClickListener() {
                    @Override
                    public void onClick(View view) {
                        startActivity(new Intent(MainActivity.this, BottomActivity.class));
                    }
                });

                binding.actionGotoOptionsActivity.setOnClickListener(new View.OnClickListener() {
                    @Override
                    public void onClick(View view) {
                        startActivity(new Intent(MainActivity.this, OptionsActivity.class));
                    }
                });

                binding.actionGotoTabbedActivity.setOnClickListener(new View.OnClickListener() {
                    @Override
                    public void onClick(View view) {
                        startActivity(new Intent(MainActivity.this, TabbedActivity.class));
                    }
                });
            }
        }
    </code>

    
    <p>La llamada a <w>setSupportActionBar()</w> <ln>15</ln> hace que la Activity utilice la <w>Toolbar</w>
            que hemos puesto en el layout, en lugar de la <w>ActionBar</w> que venia por defecto, y que hemos
            ocultado.
    </p>
    <observe>
        <p>Observa que el primer parámetro del <w>Intent</w> siempre es <w>MainActivity.this</w>, es decir, 
        el objeto correspondiente a la <w>MainActivity</w> (la activity en la que estamos). En cambio el 
        segundo parámetro es la clase <w>.class</w> de la activity que queremos iniciar en cada botón.</p>
    </observe>

    <p>Si ejecutas ahora la app, comprobarás que cada botón nos lleva a una Activity, que todavía está en blanco.
        En los siguientes pasos, implementaremos la navegación usando un menú diferente para cada una de estas activities.
    </p>
</section>

<section>
    <h2>NavigationView</h2>

    <p>El <w>NavigationView</w> (más conocido como "<strong>Drawer</strong> menu") es el menú de navegación que 
    suele aparecer por la izquierda de la app cuando se pulsa el icono Hamburger <img src="img/hamburger.png">.</p>

    <p>En la <w>DrawerActivity</w> de esta app usaremos un <w>NavigationView</w> para navegar a 3 destinos (fragments).</p>

    <img src="img/drawer3.png">
    <p>Empezamos creando el Grafo de Navegación, al que llamaremos <w>drawer_graph.xml</w>. 
        En él añadimos los 3 destinos. Para tener presente que estos destinos 
    serán accesibles desde el Drawer, les llamaremos: <w>Drawer1Fragment</w>, <w>Drawer2Fragment</w>, <w>Drawer3Fragment</w>.</p>

    <p>Crea el grafo <w>drawer_graph.xml</w> y añade los 3 destinos:</p>
    <img src="img/drawer_graph.png">

    <observe>
        <p>En este grafo de navegación no hemos creado ninguna acción de navegación, ya que los 3 destinos son 
            independientes ente sí, es decir, no se navega de ninguno a otro, sino que todos son accesibles desde el
            menú drawer.
        </p>
    </observe>

    <warn>
        <p>El siguiente paso lógico debería ser añadir el <w>NavHostFragment</w> en el layout <w>activity_drawer.xml</w>, pero no lo hacemos ahora 
        ya que en el siguiente paso hay que volver a modificar el layout.</p>
    </warn>

    <h3>Añadir el NavigationView</h3>
    <p>Android proporciona el <w>DrawerLayout</w> para ser utilizado con el <w>NavigationView</w>. Su única 
    función es permitir que el <w>NavigationView</w> pueda ponerse "por encima" de los otros elementos.</p>

    <p>Añadiremos el <w>NavigationView</w> a la <w>DrawerActivity</w>. Reemplaza el contenido del 
        fichero <file>res/layout/activity_drawer.xml</file> por este:</p>
    <codefile>
        res/layout/activity_drawer.xml
    </codefile>
    <code xml>
        &lt;?xml version="1.0" encoding="utf-8"?&gt;
        &lt;androidx.drawerlayout.widget.DrawerLayout 
            xmlns:android="http://schemas.android.com/apk/res/android"
            xmlns:app="http://schemas.android.com/apk/res-auto"
            android:id="@+id/drawer_layout"
            android:layout_width="match_parent"
            android:layout_height="match_parent"
            android:fitsSystemWindows="true"&gt;

            &lt;androidx.coordinatorlayout.widget.CoordinatorLayout
                android:layout_width="match_parent"
                android:layout_height="match_parent"&gt;

                &lt;com.google.android.material.appbar.AppBarLayout
                    android:id="@+id/appBarLayout"
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    android:theme="@style/ThemeOverlay.AppCompat.Dark.ActionBar"&gt;

                    &lt;androidx.appcompat.widget.Toolbar
                        android:id="@+id/toolbar"
                        android:layout_width="match_parent"
                        android:layout_height="?attr/actionBarSize"
                        android:background="?attr/colorPrimary"
                        app:popupTheme="@style/ThemeOverlay.AppCompat.Light" /&gt;
                &lt;/com.google.android.material.appbar.AppBarLayout&gt;

                &lt;androidx.constraintlayout.widget.ConstraintLayout
                    android:layout_width="match_parent"
                    android:layout_height="match_parent"
                    app:layout_behavior="@string/appbar_scrolling_view_behavior"&gt;

                    &lt;androidx.fragment.app.FragmentContainerView
                        android:name="androidx.navigation.fragment.NavHostFragment"
                        android:id="@+id/nav_host_fragment"
                        android:layout_width="match_parent"
                        android:layout_height="match_parent"
                        app:defaultNavHost="true"
                        app:navGraph="@navigation/drawer_graph" /&gt;
                &lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;

            &lt;/androidx.coordinatorlayout.widget.CoordinatorLayout&gt;

            &lt;com.google.android.material.navigation.NavigationView
                android:id="@+id/nav_view"
                android:layout_width="wrap_content"
                android:layout_height="match_parent"
                android:layout_gravity="start"
                android:fitsSystemWindows="true"
                app:headerLayout="@layout/drawer_header"
                app:menu="@menu/drawer_menu"/&gt;

        &lt;/androidx.drawerlayout.widget.DrawerLayout&gt;
    </code>

    <p>Observa que dentro del <w>DrawerLayout</w> hemos puesto el <w>CoordinatorLayout</w> que ya teníamos y el <w>NavigationView</w>.</p>

    <p>Además hemos añadido el <w>NavHostFragment</w> que nos habíamos saltado antes. En él es donde se mostrarán los 3 destinos 
        que hemos creado en el grafo <w>drawer_graph.xml</w>.</p>

    <h3>Cabecera y menú</h3>
    <p>Observa que hay dos atributos XML en el elemento <w>NavigationView</w> que aparecen en rojo. 
        Estos son el <w>app:headerLayout</w> y el <w>app:menu</w>. Estos dos atributos definen los ficheros en que se 
    encuentran el layout de la cabecera y los ítems del menú:</p>
     
    <img src="img/navigationview.png">

    <p>Crearemos estos dos ficheros, y definiremos la cabecera y el menú:</p>
    <ul>
        <li> <p>Cabecera: Haz clic-derecho sobre la carpeta <directory>res/layout</directory> y ve a <menuoption>New ⯈</menuoption> <menuoption>Layout Resource File</menuoption> e 
            introduce <menuoption>File name:</menuoption> <name>drawer_header</name></p>

            <img src="img/drawer_header_layout.png">

            <p>En el layout de la cabecera añadiremos una imagen y un texto:</p>
            
            <img src="img/nav_header_main.png">

            <codefile>
                res/layout/drawer_header.xml
            </codefile>
            <code xml>
                &lt;?xml version="1.0" encoding="utf-8"?&gt;
                &lt;LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
                    xmlns:app="http://schemas.android.com/apk/res-auto"
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    android:background="#009688"
                    android:gravity="center"
                    android:orientation="vertical"&gt;

                    &lt;ImageView
                        android:id="@+id/imageView"
                        android:layout_width="wrap_content"
                        android:layout_height="wrap_content"
                        android:paddingTop="48dp"
                        app:srcCompat="@mipmap/ic_launcher_round" /&gt;
                    &lt;TextView
                        android:layout_width="wrap_content"
                        android:layout_height="wrap_content"
                        android:paddingTop="8dp"
                        android:text="Android is HARD" /&gt;
                &lt;/LinearLayout&gt;
            </code>
        </li>

        <li><p>Menu: Haz clic-derecho sobre la carpeta <directory>res</directory> y ve a 
                <menuoption>New ⯈</menuoption> <menuoption>Android Resource File</menuoption> e 
                introduce <menuoption>File name:</menuoption> <name>drawer_menu</name>, 
            y selecciona <menuoption>Resource type:</menuoption> <name>Menu</name>.</p>

            <img src="img/drawer_menu.png">

            <p>Añadiremos 3 ítems al menú, que navegarán a los destinos correspondientes.</p>
            <p>Para conectar los ítems con los destinos hay que hacer <strong>coincidir los <w>id</w></strong> de los ítems con los que 
                tienen los fragments en el grafo de navegación (<w>drawer_graph.xml</w>).</p>

            <codefile>
                res/menu/drawer_menu.xml
            </codefile>
            <code xml>
                &lt;?xml version="1.0" encoding="utf-8"?&gt;
                &lt;menu xmlns:android="http://schemas.android.com/apk/res/android"&gt;
                    &lt;item
                        android:id="@+id/drawer1Fragment"
                        android:icon="@android:drawable/ic_menu_directions"
                        android:title="Drawer 1" /&gt;

                    &lt;item
                        android:id="@+id/drawer2Fragment"
                        android:icon="@android:drawable/ic_menu_directions"
                        android:title="Drawer 2" /&gt;

                    &lt;item
                        android:id="@+id/drawer3Fragment"
                        android:icon="@android:drawable/ic_menu_directions"
                        android:title="Drawer 3" /&gt;
                &lt;/menu&gt;
            </code>

            <observe>
                <p>Establecemos el valor de los atributos <w>android:icon</w> y <w>android:title</w> que deseemos.</p>
            </observe>
        </li>
    </ul>

    <h3>NavigationUI</h3>
    <p>La clase <w>NavigationUI</w>, es la encargada de administrar la navegación. Cuando se haga clic en un 
    ítem del menú, se encargará de:
    <ol>
        <li><p>resaltar el ítem seleccionado en el menú</p></li>
        <li><p>cambiar el título en la <w>Toolbar</w></p></li>
        <li><p>mostrar el destino (<em>fragment</em>) seleccionado en el <w>NavHostFragment</w></p></li>
        <li><p>gestionar el icono hamburguer (mostrando el <img src="img/drawer-hamb.png"> o la flecha atrás <img src="img/drawer-up.png">)</p></li>
    </ol>

    <p>Para activar y configurar <w>NavigationUI</w>, hay que llamar a una serie de métodos estáticos.</p>

    <p>Llamaremos a estos métodos desde la <w>DrawerActivity</w>, ya que en ella hemos puesto 
    el <w>NavigationView</w>, la <w>Toolbar</w> y el <w>NavHostFragment.</w> </p>
    
    <p>El código de la <w>DrawerActivity</w> debe quedar así:</p>

    <codefile>
        DrawerActivity.java
    </codefile>
    <code java data-line="20, 24, 30, 31">
        import android.os.Bundle;
        import androidx.appcompat.app.AppCompatActivity;
        import androidx.navigation.NavController;
        import androidx.navigation.fragment.NavHostFragment;
        import androidx.navigation.ui.AppBarConfiguration;
        import androidx.navigation.ui.NavigationUI;

        public class DrawerActivity extends AppCompatActivity {

            ActivityDrawerBinding binding;

            @Override
            protected void onCreate(Bundle savedInstanceState) {
                super.onCreate(savedInstanceState);
                setContentView((binding = ActivityDrawerBinding.inflate(getLayoutInflater())).getRoot());

                setSupportActionBar(binding.toolbar);

                AppBarConfiguration appBarConfiguration = new AppBarConfiguration.Builder(
                        // Top-level destinations:
                        R.id.drawer1Fragment, R.id.drawer2Fragment
                )
                        .setOpenableLayout(binding.drawerLayout)
                        .build();

                NavController navController = ((NavHostFragment) getSupportFragmentManager().findFragmentById(R.id.nav_host_fragment)).getNavController();
                NavigationUI.setupWithNavController(binding.navView, navController);
                NavigationUI.setupWithNavController(binding.toolbar, navController, appBarConfiguration);
            }
        }
    </code>

    <p>Hay 2 cosas que obsevar en este código:</p>
    <ul>
        <li><p>La función del objeto <w>appBarConfiguration</w> es definir los destinos que serán 
            <strong>Top-level destinations</strong> <ln>24</ln>. Si marcamos un destino como Top-level, 
            cuando se navegue a él, se mostrará el icono <em>hamb</em> <img src="img/drawer-hamb.png"> en la Toolbar. 
            En los destinos que <strong>no</strong> los pongamos como Top-level, se mostrará la flecha 
            de "atrás" <img src="img/drawer-up.png">.
        </p></li>
        <li><p>Las llamadas al método estático <w>setupWithNavController()</w>
        són las que habilitan a <w>NavigationUI</w> a administrar la navegación, sincronizando el menu <w>NavigationView</w>
        <ln>30</ln> y la barra superior <w>Tooblar</w><ln>31</ln>, con los destinos a los que se navega.</p></li>
    </ul>

    <p>Ahora puedes ejecutar la app, abrir la <w>DrawerActivity</w>, y navegar usando el <w>NaviagtionView</w> por los 3 destinos:
        <w>Drawer1Fragment</w>, <w>Drawer2Fragment</w> y <w>Drawer3Fragment</w>. Observa cómo en el tercer fragment, se muestra 
        la flecha de "atrás" <img src="img/drawer-up.png">, ya que no es un destino Top-level.
    </p>
</section>
    


<section><h2>BottomNavigationView</h2>
    <p>El <w>BottomNavigationView</w> es la barra de menú que se muestra en la parte inferior de la pantalla.</p>

    <img src="img/bottomnavigationview.png">

    <p>Añadiremos este menú en la <w>BottomActiviy</w> para navegar a 3 destinos.</p>

    <p>Creamos el grafo de navegación <w>bottom_graph.xml</w>, y añadimos tres destinos a los que 
            llamaremos <w>Bottom1Fragment</w>, <w>Bottom2Fragment</w> y <w>Bottom3Fragment</w>:</p>

    <img src="img/bottom_graph.png">

    <p>Añadimos el <w>NavHostFragment</w> en el layout de la <w>BottomActivity</w>. En él se mostrarán los 
    destinos según se vaya navegando.</p>

    <p>Añade el <w>NavHostFragment</w> dentro del <w>ConstraintLayout</w>:</p>
    <codefile>
        res/layout/activity_bottom.xml
    </codefile>
    <code xml data-line="3-9">
        &lt;androidx.constraintlayout.widget.ConstraintLayout ... &gt;

            &lt;androidx.fragment.app.FragmentContainerView
                android:name="androidx.navigation.fragment.NavHostFragment"
                android:id="@+id/nav_host_fragment"
                android:layout_width="match_parent"
                android:layout_height="match_parent"
                app:defaultNavHost="true"
                app:navGraph="@navigation/bottom_graph" /&gt;

        &lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;
    </code>

    <observe>
        <p>Observa que hemos enlazado el <w>NavHostFragment</w> con el grafo <w>bottom_graph</w>.</p>
    </observe>

    <h3>Añadir el BottomNavigationView al layout</h3>
    <p>Añade el elemento <w>&lt;BottomNavigationView&gt;</w> al layout de la <w>BottomActivity</w>. 
    Colócalo dentro del <w>ConstraintLayout</w>, justo debajo del <w>NavHostFragment</w>:</p>

    <codefile>
        res/layout/activity_bottom.xml
    </codefile>
    <code xml data-line="5-13">
        &lt;androidx.constraintlayout.widget.ConstraintLayout ...&gt;
          
            &lt;androidx.fragment.app.FragmentContainerView .../&gt;

            &lt;com.google.android.material.bottomnavigation.BottomNavigationView
                android:id="@+id/bottom_nav_view"
                android:layout_width="0dp"
                android:layout_height="wrap_content"
                android:background="?android:attr/windowBackground"
                app:layout_constraintBottom_toBottomOf="parent"
                app:layout_constraintLeft_toLeftOf="parent"
                app:layout_constraintRight_toRightOf="parent"
                app:menu="@menu/bottom_menu" /&gt;

        &lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;
    </code>


    <h3>Menu</h3>
    <p>Crea el archivo de menú para el <w>BottomNavigationView</w> (<w>res/menu/bottom_menu.xml</w>):</p>
    <img src="img/bottom_menu.png">
    
    <p>Añade los 3 ítems al menú (<strong>el <w>id</w> del item debe coincidir
          con el <w>id</w> del destino</strong>):</p>

    <codefile>
        res/menu/bottom_menu.xml
    </codefile>
    <code xml>
        &lt;?xml version="1.0" encoding="utf-8"?&gt;
        &lt;menu xmlns:android="http://schemas.android.com/apk/res/android"&gt;
            &lt;item
                android:id="@+id/bottom1Fragment"
                android:icon="@android:drawable/ic_menu_directions"
                android:title="Bottom 1" /&gt;

            &lt;item
                android:id="@+id/bottom2Fragment"
                android:icon="@android:drawable/ic_menu_directions"
                android:title="Bottom 2" /&gt;

            &lt;item
                android:id="@+id/bottom3Fragment"
                android:icon="@android:drawable/ic_menu_directions"
                android:title="Bottom 3" /&gt;
        &lt;/menu&gt;
    </code>

    <h3>NavigationUI</h3>

    <p>Ahora configuraremos <w>NavigationUI</w> en la <w>BottomActivity</w>, para que administre la navegación 
        del <w>BottomNavigationView</w>, y sincronice los títulos en la <w>Toolbar</w>.</p>

    <p>El código de la <w>BottomActivity</w> debe quedar así:</p>
    
    <codefile>
        BottomActivity.java
    </codefile>
    <code java>
        import android.os.Bundle;
        import androidx.appcompat.app.AppCompatActivity;
        import androidx.navigation.NavController;
        import androidx.navigation.fragment.NavHostFragment;
        import androidx.navigation.ui.NavigationUI;

        public class BottomActivity extends AppCompatActivity {

            ActivityBottomBinding binding;

            @Override
            protected void onCreate(Bundle savedInstanceState) {
                super.onCreate(savedInstanceState);
                setContentView((binding = ActivityBottomBinding.inflate(getLayoutInflater())).getRoot());

                setSupportActionBar(binding.toolbar);
                
                NavController navController = ((NavHostFragment) getSupportFragmentManager().findFragmentById(R.id.nav_host_fragment)).getNavController();
                NavigationUI.setupWithNavController(binding.bottomNavView, navController);
                NavigationUI.setupWithNavController(binding.toolbar, navController);
            }
        }
    </code>

    <p>Ejecuta la app, y comprueba que en la <w>BottomActivity</w> se puede navegar por los 3 destino usando 
    el <w>BottomNavigationView</w>.</p>
</section>
    







<section>
    <h2>OptionsMenu</h2>

    <p>El <w>OptionsMenu</w> es el menu desplegable que aparece en la parte superior derecha cuando se hace clic 
    en el icono de los 3 puntos <img src="img/options_dots.png"></p>

    <img src="img/menuoptions.png">

    <p>Lo usaremos para navegar a 3 destinos</p>

    <p>Crea el grafo de navegación <w>options_graph.xml</w> y añade 3 destinos: <w>Options1Fragment</w>, 
    <w>Options2Fragment</w> y <w>Options3Fragment</w>.</p>

    <img src="img/options_graph.png">

    <p>Añade el <w>NavHostFragment</w> en el layout <w>activity_options.xml</w>. Colócalo dentro del <w>ConstraintLayout</w>:</p>

    <codefile>
        res/layout/activity_options.xml
    </codefile>
    <code xml data-line="3-9">
        &lt;androidx.constraintlayout.widget.ConstraintLayout ...&gt;

            &lt;androidx.fragment.app.FragmentContainerView
                android:name="androidx.navigation.fragment.NavHostFragment"
                android:id="@+id/nav_host_fragment"
                android:layout_width="match_parent"
                android:layout_height="match_parent"
                app:defaultNavHost="true"
                app:navGraph="@navigation/options_graph" /&gt;

        &lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;
    </code>

    <observe>
        <p>Observa que hemos enlazado el <w>NavHostFragment</w> con el grafo <w>options_graph</w>.</p>
    </observe>

    <h3>Menu</h3>

    <p>Crea el archivo de menú para el OptionsMenu (<w>res/menu/options_menu.xml</w>). 
        Añade los ítems:</p>
    
    <codefile>
        res/menu/options_menu.xml
    </codefile>
    <code xml>
        &lt;?xml version="1.0" encoding="utf-8"?&gt;
        &lt;menu xmlns:android="http://schemas.android.com/apk/res/android"
            xmlns:app="http://schemas.android.com/apk/res-auto"&gt;

            &lt;item
                android:id="@+id/options1Fragment"
                android:icon="@android:drawable/ic_menu_directions"
                android:title="Options 1"
                app:showAsAction="always"/&gt;

            &lt;item
                android:id="@+id/options2Fragment"
                android:icon="@android:drawable/ic_menu_directions"
                android:title="Options 2" /&gt;

            &lt;item
                android:id="@+id/options3Fragment"
                android:icon="@android:drawable/ic_menu_directions"
                android:title="Options 3" /&gt;

        &lt;/menu&gt;
    </code>

    <p>En el item <w>options1Fragment</w> hemos añadido el atributo <w> app:showAsAction="always"</w>, 
        esto hará que esta opción del menú no se muestre en el desplegable, sino que se muestre como un icono
        en la barra.</p>

    <img src="img/showasaction.png">

    <h3>NavigationUI</h3>

    <p>Por último, configuraremos <w>NavigationUI</w> para que gestione la navegación del Options Menu.</p>

    <codefile>
        OptionsActivity.java
    </codefile>
    <code java>
        import android.os.Bundle;
        import android.view.Menu;
        import android.view.MenuItem;
        import androidx.appcompat.app.AppCompatActivity;
        import androidx.navigation.NavController;
        import androidx.navigation.fragment.NavHostFragment;
        import androidx.navigation.ui.AppBarConfiguration;
        import androidx.navigation.ui.NavigationUI;

        public class OptionsActivity extends AppCompatActivity {

            ActivityOptionsBinding binding;
            private NavController navController;

            @Override
            protected void onCreate(Bundle savedInstanceState) {
                super.onCreate(savedInstanceState);
                setContentView((binding = ActivityOptionsBinding.inflate(getLayoutInflater())).getRoot());

                setSupportActionBar(binding.toolbar);

                AppBarConfiguration appBarConfiguration = new AppBarConfiguration.Builder(
                        R.id.options1Fragment, R.id.options2Fragment
                )
                        .build();

                navController = ((NavHostFragment) getSupportFragmentManager().findFragmentById(R.id.nav_host_fragment)).getNavController();
                NavigationUI.setupWithNavController(binding.toolbar, navController, appBarConfiguration);
            }

            @Override
            public boolean onCreateOptionsMenu(Menu menu) {
                getMenuInflater().inflate(R.menu.options_menu, menu);
                return true;
            }

            @Override
            public boolean onOptionsItemSelected(MenuItem item) {
                return NavigationUI.onNavDestinationSelected(item, navController)
                        || super.onOptionsItemSelected(item);
            }
        }
    </code>

    <p>En esta activity se han anulado (<w>@Override</w>) dos métodos:</p>
    <ul>
        <li><p>El método <w>onCreateOptionsMenu()</w> establece los ítems del <w>OptionsMenu</w> (los que 
        hemos establecido en el fichero <w>R.menu.options_menu</w>).</p></li>
        <li><p>El método <w>onOptionsItemSelected()</w> hace que se use el <w>navController</w> para navegar 
        al destino cuando se pulse en un ítem.</p></li>
    </ul>

    <p>Ejecuta la app y comprueba la navegación con el <w>OptionsMenu</w>. Observa que el primer ítem aparece 
    como un icono en la barra. Y también que cuando se navega al tercer fragment, aparece el boton de "atrás" 
    <img src="img/drawer-up.png">, ya que no está puesto como destino Top-level.</p>
</section>
    
<section>
    <h2>TabLayout y ViewPager2</h2>

    <p>El elemento <w>ViewPager2</w> permite crear vistas deslizantes a las que se puede navegar deslizando 
    el dedo. El elemento <w>TabLayout</w> añade unas pestañas en la parte superior.</p>

    <img src="img/tabbedactivity.gif">

    <warn>
        <p>Estos elementos no forman parte del componente <w>Navigation</w>, y no son gestionados por <w>NavigationUI</w>.</p>
    </warn>

    <p>En la activity <w>TabbedActivity</w>, añadiremos un fragment que incluirá un <w>ViewPager2</w> y un <w>TabLayout</w>,
    que permitirán deslizarse entre 3 fragments (A, B y C).</p>

    <img src="img/Viewpager2tablayout.png">

    <p>Empezaremos creando el grafo de navegación de la <w>TabbedActivity</w>, al que llamaremos <w>tabbed_graph.xml</w>. 
    En este grafo añadimos únicamente el fragment <w>Tabbed1Fragment</w>.</p>
    
    <img src="img/tabbed_graph.png">

    <p>Añadimos el <w>NavHostFragment</w> al layout <w>activity_tabbed.xml</w>:</p>

    <codefile>
        res/layout/activity_tabbed.xml
    </codefile>
    <code xml>
        &lt;androidx.constraintlayout.widget.ConstraintLayout ...&gt;

        &lt;androidx.fragment.app.FragmentContainerView
            android:name="androidx.navigation.fragment.NavHostFragment"
            android:id="@+id/nav_host_fragment"
            android:layout_width="match_parent"
            android:layout_height="match_parent"
            app:defaultNavHost="true"
            app:navGraph="@navigation/tabbed_graph" /&gt;

    &lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;
    </code>

    <p>En este <w>NavHostFragment</w> únicamente se mostrará el <w>Tabbed1Fragment</w>.</p>

    <h3>Crear las páginas deslizantes</h3>
    <p>Crearemos 3 fragments (<em>A</em>, <em>B</em>, <em>C</em>), que serán los que se deslizen por el <w>Tabbed1Fragment</w>.</p>

    <p>Estos 3 fragments <strong>no</strong> se crean en el grafo de navegación, ya que no se navegará 
    entre ellos usando <w>Navigation</w>, sino usando el <w>ViewPager2</w>.</p>

    <p>Llamaremos a estos fragments: <w>Tabbed1AFragment</w>, <w>Tabbed1BFragment</w> y <w>Tabbed1CFragment</w>.</p>
    <p>Para crear un Fragment, haz clic-derecho sobre la carpeta <directory>app</directory> y 
        selecciona <menuoption>New ⯈</menuoption> 
        <menuoption>Fragment ⯈</menuoption> <menuoption>Fragment (Blank)</menuoption>.
    <br>En el campo <menuoption>Fragment Name</menuoption>, introduce el nombre del campo.</p>

    <p>Crea los 3 fragments: <w>Tabbed1AFragment</w>, <w>Tabbed1BFragment</w> y <w>Tabbed1CFragment</w>.</p>

    <img src="img/tabbed_abc.png">

    <h3>Añadir el ViewPager2</h3>
    <p>En el layout del <w>Tabbed1Fragment</w> añadimos el <w>ViewPager2</w>. En él se mostrarán los 3 
    fragments (A,B,C) que hemos creado.</p>

    <codefile>
        res/layout/fragment_tabbed1.xml
    </codefile>
    <code xml>
        &lt;?xml version="1.0" encoding="utf-8"?&gt;
        &lt;FrameLayout xmlns:android="http://schemas.android.com/apk/res/android"
            android:layout_width="match_parent"
            android:layout_height="match_parent"&gt;
        
            &lt;androidx.viewpager2.widget.ViewPager2
                android:id="@+id/viewPager"
                android:layout_width="match_parent"
                android:layout_height="match_parent" /&gt;
        
        &lt;/FrameLayout&gt;
    </code>

    <p>Para vincular los 3 fragments (A,B,C) con el <w>ViewPager2</w>, hay que llamar al método <w>setAdapter()</w> y 
    pasárle un objeto <w>FragmentStateAdapter</w> con la configuración.</p>

    <p>Realizaremos esta llamada en el método <w>onViewCreated()</w> del <w>Tabbed1Fragment</w>.</p>

    <p>La clase <w>Tabbed1Fragment</w> debe quedar así:</p>

    <codefile>
        Tabbed1Fragment.java
    </codefile>
    <code java>
        import android.os.Bundle;
        import android.view.LayoutInflater;
        import android.view.View;
        import android.view.ViewGroup;
        import androidx.annotation.NonNull;
        import androidx.annotation.Nullable;
        import androidx.fragment.app.Fragment;
        import androidx.viewpager2.adapter.FragmentStateAdapter;

        public class Tabbed1Fragment extends Fragment {
            private FragmentTabbed1Binding binding;

            @Override
            public View onCreateView(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState) {
                return (binding = FragmentTabbed1Binding.inflate(inflater, container, false)).getRoot();
            }

            @Override
            public void onViewCreated(@NonNull View view, @Nullable Bundle savedInstanceState) {
                super.onViewCreated(view, savedInstanceState);

                binding.viewPager.setAdapter(new FragmentStateAdapter(this) {
                    @NonNull
                    @Override
                    public Fragment createFragment(int position) {
                        switch (position) {
                            case 0: default:
                                return new Tabbed1AFragment();
                            case 1:
                                return new Tabbed1BFragment();
                            case 2:
                                return new Tabbed1CFragment();
                        }
                    }

                    @Override
                    public int getItemCount() {
                        return 3;
                    }
                });
            }
        }
    </code>

    <p>El objeto de clase <w>FragmentStateAdapter</w> configura el <w>viewPager</w> anulando dos métodos:</p>
    <ul>
        <li><p><w>createFragment()</w> retorna el fragment que se debe mostrar en función de la posición de la 
        página.</p></li>
        <li><p><w>getItemCount()</w> retorna el número de páginas que debe tener el viewPager.</p></li>
    </ul>

    <p>Si ejecutas la app, verás que se pueden deslizar los 3 fragments (A,B,C).</p>

    <h3>Añadir el TabLayout</h3>
    <p>En el layout <w>fragment_tabbed1.xml</w> añadimos el <w>&lt;TabLayout&gt;</w> justo arriba del <w>ViewPager2</w>. 
    Reemplaza el contenido por el siguiente:</p>

    <codefile>
        res/layout/fragment_tabbed1.xml
    </codefile>
    <code xml>
        &lt;?xml version="1.0" encoding="utf-8"?&gt;
        &lt;LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
            android:layout_width="match_parent"
            android:layout_height="match_parent"
            android:orientation="vertical"&gt;

            &lt;com.google.android.material.tabs.TabLayout
                android:id="@+id/tabLayout"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"/&gt;
            
            &lt;androidx.viewpager2.widget.ViewPager2
                android:id="@+id/viewPager"
                android:layout_width="match_parent"
                android:layout_height="match_parent" /&gt;

        &lt;/LinearLayout&gt;
    </code>
    
    <observe>
        <p>Hemos cambiado el <w>FrameLayout</w> por un <w>LinearLayout</w> con orientacion vertical, para 
        que el TabLayout y el ViewPager2 se muestren un encima el otro.</p>
    </observe>

    <p>Para vincular el <w>TabLayout</w> con el <w>ViewPager2</w>, de forma que la página cambie cuando se 
    pulsa en una pestaña, y viceversa, hay que crear un objeto <w>TabLayoutMediator</w> al que se le pasan 
    el <w>TabLayout</w> y <w>ViewPager2</w>. También 
    se le pasa un <w>TabConfigurationStrategy</w> indicando el titulo que se debe mostrar en cada Tab.
    Por último, se llama al método <w>attach()</w> de este objeto.</p>

    <p>Añade el código resaltado en <w>Tabbed1Fragment</w>:</p>

    <codefile>
        Tabbed1Fragment.java
    </codefile>
    <code java data-line="10-25">
        public class Tabbed1Fragment extends Fragment {
            ...
            @Override
            public void onViewCreated(@NonNull View view, @Nullable Bundle savedInstanceState) {
                ...
                binding.viewPager.setAdapter(new FragmentStateAdapter(this) {
                    ...
                });

                new TabLayoutMediator(binding.tabLayout, binding.viewPager, new TabLayoutMediator.TabConfigurationStrategy() {
                    @Override
                    public void onConfigureTab(@NonNull TabLayout.Tab tab, int position) {
                        switch (position) {
                            case 0: default:
                                tab.setText("TAB A");
                                break;
                            case 1:
                                tab.setText("TAB B");
                                break;
                            case 2:
                                tab.setText("TAB C");
                                break;
                        }
                    }
                }).attach();
            }
        }
    </code>

    <p>Ahora ya se muestran los Tabs, con el título y sincronizados con las páginas.</p>
</section>
    
<section>
    <h2>Práctica</h2>
        
    <p>Desarrolla una app con una sola Activity, que implemente la navegación usando los 
        elementos <w>NavigationView</w>, <w>BottomNavigationView</w>, <w>OptionsMenu</w> y 
        <w>ViewPager2 + TabLayout</w>.
    </p>

    <img src="img/p3navigation.gif">
</section>
    